let sections={},section;class Section{#e;id;pageElement;constructor(){this.#e=this}init(){}close(e){document.querySelectorAll("section").forEach((t=>{t.id==e&&t.remove()}))}instance(){return this.#e}}class App{token;autenticated;sectionHash;static init(){window.addEventListener("hashchange",App.manageURL),document.querySelector("#menuItemlogout").addEventListener("click",(function(){App.token(null),App.showMenu(!1),window.location.href="#login"})),App.check()}static token(e){let t;return void 0!==e?null==e?(localStorage.removeItem("token"),t=null):t=localStorage.setItem("token",e):t=localStorage.getItem("token"),t}static manageURL(){if(App.sectionHash=window.location.hash.substr(1),""==App.sectionHash&&(App.sectionHash="home"),null==App.token()){if("login"!=App.sectionHash)return void(window.location.href="#login");App.load("login")}else{if("login"==App.sectionHash)return void(window.location.href="#home");App.load(App.sectionHash),App.showMenu(!0)}}static check(e){App.send("app","check",{},(e=>{e.valid?App.token(e.token):App.token(null),App.manageURL()}))}static auth(e,t){App.send("app","auth",{username:e,password:t},(e=>{e.valid||alert("Los datos introducidos no son correctos"),App.token(e.token),e.valid&&(window.location.href="#home")}))}static load(sectionId){if(section&&section.onHide&&section.onHide(),sections[sectionId])return section=sections[sectionId],App.show(sectionId),void(section.onShow&&section.onShow());fetch(`sections/${sectionId}.html`).then((e=>e.text())).then(function(data){let page=document.createElement("section");page.id=sectionId;let fragment=document.createRange().createContextualFragment(data);page.appendChild(fragment),section&&section.pageElement.classList.add("d-none"),document.querySelector("main").appendChild(page);const scripts=page.querySelectorAll("script");scripts.forEach((script=>{script.src||eval(script.textContent)}));let _class=sectionId.replace(/[-_\/]/g," ");_class=_class.split(" ").map((e=>e.charAt(0).toUpperCase()+e.substring(1))).join(""),_class="Section"+_class;try{const Clase=eval(_class);section=eval(`new ${_class}()`)}catch(e){}section&&(section.id=sectionId,section.pageElement=page,section.onInit&&section.onInit(),App.show(sectionId),section.onShow&&section.onShow(),sections[sectionId]=section)}.bind(this)).catch((e=>{}))}static show(e){document.querySelectorAll("main section").forEach((t=>{t.id==e?t.classList.remove("d-none"):t.classList.add("d-none")}))}static showMenu(e){document.querySelectorAll(".user-item").forEach((t=>{e?t.classList.remove("d-none"):t.classList.add("d-none")}))}static send(e,t,n={},o=null,s=null){const c={namespace:e,action:t,data:n,token:localStorage.getItem("token")},i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)};fetch("api.php",i).then((function(e){return e.json()})).then((e=>{o&&o(e.data)})).catch((function(e){s&&s(e)}))}}